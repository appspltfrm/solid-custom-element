{"version":3,"file":"defineLazyCustomElement.js","sources":["../src/lib/defineLazyCustomElement.ts"],"sourcesContent":["const elements: {[tagName: string]: () => CustomElementConstructor} = {};\n\nconst observer = new MutationObserver((mutations) => {\n\n    // elements that were defined within this call\n    let definedElements: string[] = [];\n\n    for (const m of mutations) {\n        if (m.addedNodes) {\n            for (const n of m.addedNodes) {\n                if (n instanceof Element && elements[n.tagName]) {\n                    if (!customElements.get(n.tagName)) {\n                        customElements.define(n.tagName, elements[n.tagName]());\n                        definedElements.push(n.tagName);\n                    }\n\n                    if (definedElements.includes(n.tagName)) {\n                        customElements.upgrade(n);\n                    }\n                }\n            }\n        }\n    }\n\n    for (const e of definedElements) {\n        delete elements[e];\n    }\n\n    if (Object.keys(elements).length === 0) {\n        observer.disconnect();\n    }\n})\n\nlet connected = false;\n\nexport function defineLazyCustomElement(tagName: string, loader: () => CustomElementConstructor) {\n\n    tagName = tagName.toUpperCase();\n\n    // already defined and loaded\n    if (customElements.get(tagName)) {\n        return;\n    }\n\n    elements[tagName] = loader;\n\n    if (!connected) {\n        connected = true;\n        observer.observe(document, {subtree: true, childList: true});\n    }\n}\n"],"names":["elements","observer","mutations","definedElements","m","n","e","connected","defineLazyCustomElement","tagName","loader"],"mappings":"AAAA,MAAMA,IAAgE,CAAA,GAEhEC,IAAW,IAAI,iBAAiB,CAACC,MAAc;AAGjD,MAAIC,IAA4B,CAAA;AAEhC,aAAWC,KAAKF;AACZ,QAAIE,EAAE;AACS,iBAAAC,KAAKD,EAAE;AACd,QAAIC,aAAa,WAAWL,EAASK,EAAE,OAAO,MACrC,eAAe,IAAIA,EAAE,OAAO,MAC7B,eAAe,OAAOA,EAAE,SAASL,EAASK,EAAE,OAAO,GAAG,GACtCF,EAAA,KAAKE,EAAE,OAAO,IAG9BF,EAAgB,SAASE,EAAE,OAAO,KAClC,eAAe,QAAQA,CAAC;AAO5C,aAAWC,KAAKH;AACZ,WAAOH,EAASM,CAAC;AAGrB,EAAI,OAAO,KAAKN,CAAQ,EAAE,WAAW,KACjCC,EAAS,WAAW;AAE5B,CAAC;AAED,IAAIM,IAAY;AAEA,SAAAC,EAAwBC,GAAiBC,GAAwC;AAKzF,EAHJD,IAAUA,EAAQ,eAGd,gBAAe,IAAIA,CAAO,MAI9BT,EAASS,CAAO,IAAIC,GAEfH,MACWA,IAAA,IACZN,EAAS,QAAQ,UAAU,EAAC,SAAS,IAAM,WAAW,IAAK;AAEnE;"}